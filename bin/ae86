#!/usr/bin/env node

var path = require('path'),
    AE86 = require('../lib/ae86').AE86,
    dir = process.cwd(),
    args = process.argv.slice(2),
    usage, abort, options;
    
usage = 'Usage: ae86 [options]\n'
    + '\n'
    + 'Options:\n'
    + '  -o, --out      The directory where the static pages will be written to\n'
    + '  -e, --engine   The templating engine\n'
    + '  -h, --help     Display help info\n';

abort = function (message) {
    console.error(message);
    process.exit(1);
};

while (args.length) {
    var arg = args.shift();
    switch (arg) {
        case '-o':
        case '--out':
            args.length
                ? (args.out = args.shift())
                : abort('--out requires an argument');
            break;
        case '-e':
        case '--engine':
            args.length
                ? (args.engine = args.shift())
                : abort('--engine requires an argument');
            break;
        case '-h':
        case '--help':
            abort(usage);
            break;
    }
}

options = {
        layouts: path.join(dir, 'layouts'),
        pages: path.join(dir, 'pages'),
        partials: path.join(dir, 'partials'),
        static: path.join(dir, 'static'),
        out: path.join(dir, (args.out || 'out')),
        params: (path.existsSync(path.join(dir, 'params.js'))) ? require(path.join(dir, 'params')).params : {},
        engine: args.engine || 'jazz',
        encoding: args.encoding || 'utf-8'
    },
    ae86 = new AE86(options);
ae86.drift();